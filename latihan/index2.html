<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tabel Data dengan DataTables</title>
    <!-- DataTables CSS -->
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/2.0.8/css/dataTables.dataTables.css">
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .container { max-width: 1200px; margin: auto; }
        table { width: 100%; }
        /* Style untuk menjaga tombol tetap rapi */
        .actions-cell button { margin: 2px; }
        /* Style untuk teks yang bisa diperluas */
        .expandable-text {
            cursor: pointer;
            color: #007bff;
        }
        .expandable-text:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>

<div class="container">
    <h2>Data Tabel Nilai1</h2>
    <table id="dataTable" class="display" style="width:100%">
        <thead>
            <tr>
                <th>ID</th>
                <th>x_01</th>
                <th>x_02</th>
                <th>x_03</th>
                <th>x_04</th>
                <th>x_05</th>
                <th>x_06</th>
                <th>x_07</th>
                <th>x_08</th>
                <th>x_09</th>
                <th>x_10</th>
                <th>x_11</th>
                <th>x_12</th>
                <th>x_13</th>
                <th>x_14</th>
                <th>x_15</th>
                <th>x_16</th>
                <th>x_17</th>
                <th>x_18</th>
                <th>x_19</th>
                <th>x_20</th>
                <th>Aksi</th>
            </tr>
        </thead>
        <tbody>
            <!-- Data will be populated by DataTables -->
        </tbody>
    </table>
</div>

<!-- jQuery (wajib untuk DataTables) -->
<script src="https://code.jquery.com/jquery-3.7.1.js"></script>
<!-- DataTables JS -->
<script src="https://cdn.datatables.net/2.0.8/js/dataTables.js"></script>

<script>
    // URL API Anda
    const API_URL = 'https://lidan-co-id.pages.dev/api/contacts_filter_dinamis?table=nilai1';

    // Fungsi helper untuk memotong teks
    function truncateText(data, maxLength = 20) {
        if (data && typeof data === 'string' && data.length > maxLength) {
            return data.substring(0, maxLength) + '...';
        }
        return data;
    }

    $(document).ready(function() {
        // Inisialisasi DataTables
        var table = $('#dataTable').DataTable({
            processing: true,
            searching: false,
            paging: true,
            info: true,
            autoWidth: false,
            serverSide: false,
            ajax: {
                url: API_URL,
                dataSrc: 'data' // Sesuaikan dengan properti data di respons API Anda
            },
            columns: [
                { data: 'id_x' },
                // Memakai fungsi render untuk menampilkan teks lengkap saat diklik
                { data: 'x_01', render: function(data) { return `<span class="expandable-text" data-full-text="${data}" data-truncated-text="${truncateText(data)}">${truncateText(data)}</span>`; } },
                { data: 'x_02', render: function(data) { return `<span class="expandable-text" data-full-text="${data}" data-truncated-text="${truncateText(data)}">${truncateText(data)}</span>`; } },
                { data: 'x_03', render: function(data) { return `<span class="expandable-text" data-full-text="${data}" data-truncated-text="${truncateText(data)}">${truncateText(data)}</span>`; } },
                { data: 'x_04', render: function(data) { return `<span class="expandable-text" data-full-text="${data}" data-truncated-text="${truncateText(data)}">${truncateText(data)}</span>`; } },
                { data: 'x_05', render: function(data) { return `<span class="expandable-text" data-full-text="${data}" data-truncated-text="${truncateText(data)}">${truncateText(data)}</span>`; } },
                { data: 'x_06', render: function(data) { return `<span class="expandable-text" data-full-text="${data}" data-truncated-text="${truncateText(data)}">${truncateText(data)}</span>`; } },
                { data: 'x_07', render: function(data) { return `<span class="expandable-text" data-full-text="${data}" data-truncated-text="${truncateText(data)}">${truncateText(data)}</span>`; } },
                { data: 'x_08', render: function(data) { return `<span class="expandable-text" data-full-text="${data}" data-truncated-text="${truncateText(data)}">${truncateText(data)}</span>`; } },
                { data: 'x_09', render: function(data) { return `<span class="expandable-text" data-full-text="${data}" data-truncated-text="${truncateText(data)}">${truncateText(data)}</span>`; } },
                { data: 'x_10', render: function(data) { return `<span class="expandable-text" data-full-text="${data}" data-truncated-text="${truncateText(data)}">${truncateText(data)}</span>`; } },
                { data: 'x_11', render: function(data) { return `<span class="expandable-text" data-full-text="${data}" data-truncated-text="${truncateText(data)}">${truncateText(data)}</span>`; } },
                { data: 'x_12', render: function(data) { return `<span class="expandable-text" data-full-text="${data}" data-truncated-text="${truncateText(data)}">${truncateText(data)}</span>`; } },
                { data: 'x_13', render: function(data) { return `<span class="expandable-text" data-full-text="${data}" data-truncated-text="${truncateText(data)}">${truncateText(data)}</span>`; } },
                { data: 'x_14', render: function(data) { return `<span class="expandable-text" data-full-text="${data}" data-truncated-text="${truncateText(data)}">${truncateText(data)}</span>`; } },
                { data: 'x_15', render: function(data) { return `<span class="expandable-text" data-full-text="${data}" data-truncated-text="${truncateText(data)}">${truncateText(data)}</span>`; } },
                { data: 'x_16', render: function(data) { return `<span class="expandable-text" data-full-text="${data}" data-truncated-text="${truncateText(data)}">${truncateText(data)}</span>`; } },
                { data: 'x_17', render: function(data) { return `<span class="expandable-text" data-full-text="${data}" data-truncated-text="${truncateText(data)}">${truncateText(data)}</span>`; } },
                { data: 'x_18', render: function(data) { return `<span class="expandable-text" data-full-text="${data}" data-truncated-text="${truncateText(data)}">${truncateText(data)}</span>`; } },
                { data: 'x_19', render: function(data) { return `<span class="expandable-text" data-full-text="${data}" data-truncated-text="${truncateText(data)}">${truncateText(data)}</span>`; } },
                { data: 'x_20', render: function(data) { return `<span class="expandable-text" data-full-text="${data}" data-truncated-text="${truncateText(data)}">${truncateText(data)}</span>`; } },
                {
                    data: null,
                    className: "actions-cell",
                    render: function(data, type, row) {
                        return `<button onclick="editItem(${row.id_x})">Edit</button> <button onclick="deleteItem(${row.id_x})">Hapus</button>`;
                    }
                }
            ]
        });

        // Event listener untuk menangani klik pada teks yang dapat diperluas
        $('#dataTable').on('click', '.expandable-text', function() {
            const span = $(this);
            const currentText = span.text();
            const fullText = span.data('full-text');
            const truncatedText = span.data('truncated-text');

            // Toggle antara teks lengkap dan teks yang dipotong
            if (currentText === truncatedText) {
                span.text(fullText);
            } else {
                span.text(truncatedText);
            }
        });
    });

    // Fungsi placeholder untuk Edit
    function editItem(id) {
        alert('Fungsi Edit untuk ID: ' + id + ' (implementasi CRUD Anda)');
    }

    // Fungsi placeholder untuk Delete
    async function deleteItem(id) {
        if (confirm(`Yakin ingin menghapus data dengan ID ${id}?`)) {
            const API_URL_DELETE = `https://lidan-co-id.pages.dev/api/contacts_filter_dinamis?table=nilai1&id_x=${id}`;
            try {
                const response = await fetch(API_URL_DELETE, { method: 'DELETE' });
                const result = await response.json();
                if (result.success) {
                    alert('Data berhasil dihapus!');
                    $('#dataTable').DataTable().ajax.reload();
                } else {
                    alert('Gagal menghapus data: ' + result.message);
                }
            } catch (error) {
                console.error('Error deleting data:', error);
                alert('Terjadi kesalahan saat menghapus data.');
            }
        }
    }
</script>

</body>
</html>
