<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <title>Profil Pemeriksaan Psikologis</title>
    <style>
        body {
            color: black;
            font-family: Arial, sans-serif;
            margin: 0;
            background-color: #7000E0;
            /*background-image: url('https://placehold.co/1920x1080/7000E0/FFFFFF?text=Latar+Belakang');*/
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px 0;
        }
        .container1, .container_a {
            color: black;
            background: white;
            width: 280mm;
            padding: 20px;
            background-color: white;
            border: 1px solid black;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            margin: 20px auto;
            position: relative;
        }
        .container1 {
            height: 370mm;
        }
        .container_a {
            height: 365mm;
            overflow: hidden;
        }
        .container_a::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url('gambar/logo1.png');
            background-size: 70%;
            background-position: center;
            background-repeat: no-repeat;
            opacity: 0.1;
            z-index: 0;
        }
        .container_a > * {
            position: relative;
            z-index: 1;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            border-top: 3px double black;
            border-bottom: 3px double black;
        }
        th, td {
            padding: 8px;
            border: 1px solid black;
        }
        th {
            text-align: center;
        }
        td {
            text-align: left;
        }
        .header {
            background-color: #f2f2f2;
        }
        .strength-weakness {
            margin-top: 20px;
        }
        .signature {
            margin-top: 20px;
            text-align: right;
        }
        .highlight {
            background-color: #d1e7dd;
            font-size: 16px;
            margin: 0;
            padding: 0;
            text-align: center;
        }
        .no-inner-borders td {
            border: none;
        }
        .section-header {
            font-weight: bold;
            color: white;
            background-color: black;
            text-align: center;
        }
        .custom-header {
            display: grid;
            grid-template-columns: auto 1fr;
            align-items: center;
            margin-bottom: 20px;
            background-color: #5F4EDA;
            padding: 10px;
            border-radius: 8px;
        }
        .logo-container_a {
            margin-right: 10px;
        }
        .logo {
            width: 130px;
            height: auto;
        }
        .info-container_a {
            text-align: center;
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-left: -80px;
        }
        .header-title {
            font-size: 24px;
            font-weight: bold;
            color: white;
            margin: 2px 0;
        }
        .header-subtitle {
            font-size: 18px;
            font-style: italic;
            color: #e0f7fa;
            margin: 2px 0;
        }
        .location, .address, .phone, .website {
            margin: 2px 0;
            color: white;
        }
        .custom-table {
            border-collapse: collapse;
            width: 100%;
        }
        .custom-table td {
            padding: 5px;
            margin: 0;
        }
        .custom-list {
            margin-left: 10px;
            margin-top: 5px;
            padding: 0;
            list-style-position: inside;
        }
        #downloadBtn {
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        @media print {
            body {
                background: white;
            }
            .container1, .container_a {
                box-shadow: none;
                border: none;
                margin: 0;
            }
            #downloadBtn {
                display: none;
            }
        }
    </style>
</head>
<body>

    <div class="batas-download" id="downloadContent1">
        <div class="container1">
            <div class="custom-header no-download" style="background-color: #5F4EDA;">
                    <div class="logo-container_a">
                        <img src="gambar/logo1.png" alt="Logo" class="logo"/>
                    </div>
                    <div class="info-container_a">
                        <div class="header-title" style="color: white; font-size: 24px; font-weight: bold;">PT. LIDAN INDAH ABADI</div>
                        <div class="header-subtitle" style="color: #e0f7fa; font-size: 18px; font-style: italic;">LIDAN PSIKOLOGI</div>
                        <div class="location" style="color: white;">Regus Forum Nine, Lantai 9 CIMB NIAGA PLAZA</div>
                        <div class="address" style="color: white;">Jalan Imam Bonjol No.9, Medan 20159, Sumatera Utara</div>
                        <div class="phone" style="color: white;">Telepon: +62851-5960-1400</div>
                        <div class="website" style="color: #e0f7fa;">
                            Website: <a href="http://www.lidan.co.id" style="color: #e0f7fa; text-decoration: underline;">www.lidan.co.id</a>, Email: 
                            <a href="mailto:cs@lidan.co.id" style="color: #e0f7fa; text-decoration: underline;">cs@lidan.co.id</a>
                        </div>
                    </div>
                </div>
            <h2 style="text-align: center;">PROFIL PEMERIKSAAN PSIKOLOGIS</h2>
            <table class="no-inner-borders custom-table">
                <tr>
                    <td style="width: 200px; border-left: none;">Nama</td>
                    <td style="width: 20px;">:</td>
                    <td style="border-right: none;" id="nama"></td>
                </tr>
                <tr>
                    <td style="border-left: none;">Jenis Kelamin</td>
                    <td>:</td>
                    <td style="border-right: none;" id="jenis_kelamin"></td>
                </tr>
                <tr>
                    <td style="border-left: none;">Usia</td>
                    <td>:</td>
                    <td style="border-right: none;" id="usia"></td>
                </tr>
                <tr>
                    <td style="border-left: none;">Pendidikan</td>
                    <td>:</td>
                    <td style="border-right: none;" id="pendidikan"></td>
                </tr>
                <tr>
                    <td style="border-left: none;">Posisi</td>
                    <td>:</td>
                    <td style="border-right: none;" id="posisi"></td>
                </tr>
                <tr>
                    <td style="border-left: none;">Tanggal Pemeriksaan</td>
                    <td>:</td>
                    <td style="border-right: none;" id="tanggal_pemeriksaan"></td>
                </tr>
                <tr>
                    <td style="border-left: none;">Tujuan Pemeriksaan</td>
                    <td>:</td>
                    <td style="border-right: none;" id="tujuan_pemeriksaan"></td>
                </tr>
            </table>
            <h3 style="text-align: center;">Aspek Psikologis</h3>
            <table id="aspek-psikologis-table">
                <thead>
                    <tr class="header">
                        <th rowspan="2" style="width: 250px; vertical-align: top;">Aspek Psikologis</th>
                        <th rowspan="2" style="width: 400px; vertical-align: top;">Keterangan</th>
                        <th colspan="10">Skala</th>
                    </tr>
                    <tr class="header1">
                        <th colspan="4">K</th>
                        <th colspan="2">C</th>
                        <th colspan="2">B</th>
                        <th colspan="2">BS</th>
                    </tr>
                </thead>
                <tbody id="aspek-psikologis-body">
                    <!-- Rows will be generated by JavaScript -->
                </tbody>
            </table>
            <br>
            *Keterangan : K = Kurang ; C = Cukup ; B = Baik ; BS = Baik Sekali
        </div>
    </div>

    <div class="batas-download" id="downloadContent2">
        <div class="container_a">
            <div class="strength-weakness">
                <div><strong>Intelligence Quotient (IQ) :</strong></div>
                <ul class="custom-list">
                    <li id="iq-value"></li>
                </ul>
                <div><strong>Strengths/Kelebihan:</strong></div>
                <ul class="custom-list" id="strengths-list">
                    <!-- Strengths will be generated by JavaScript -->
                </ul>
                <div><strong>Weaknesses/Kelemahan:</strong></div>
                <ul class="custom-list" id="weaknesses-list">
                    <!-- Weaknesses will be generated by JavaScript -->
                </ul>
                <div><strong>Recommendation/Rekomendasi:</strong></div>
                <ul class="custom-list" id="recommendations-list">
                    <!-- Recommendations will be generated by JavaScript -->
                </ul>
                <h4 style="text-decoration: underline;">Arah Minat Pendidikan / Pekerjaan</h4>
                <ul class="custom-list" id="minat-list">
                    <!-- Minat will be generated by JavaScript -->
                </ul>
            </div>
            <br>
            <div class="signature">
                <p><strong id="signature-date">Medan, </strong></p>
                <p style="margin-top: -12px;">Psikolog,</p>
                <img src="gambar/ttd.png" alt="Psychologist Image" style="max-width: 20%; height: auto;"/>
                <p style="margin-top: -5px;"><strong>Dr. Karina M. Brahmana, M.Psi, Psikolog</strong></p>
                <p style="margin-top: -12px;">No SIPP: 20070136-2021-02-0799</p><br>
                
    <img class="no-download" src="gambar/medsos.png" alt="Psychologist Image" style="max-width: 20%; height: auto;"/>
            </div>
        </div>
    </div>

    <button id="downloadBtn">Download PDF</button>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <script src="script.js"></script>
    <script>
        
        // Fungsi untuk mengambil data dan menampilkannya
        async function fetchAndLogData() {
            try {
                // Mendapatkan URL saat ini
                const currentURL = window.location.href;
                const url = new URL(currentURL);
                const params = new URLSearchParams(url.search);
                const id_x = params.get('id_x');

                if (!id_x) {
                    console.error('Parameter id_x tidak ditemukan di URL.');
                    return;
                }

                const API_URL = `https://lidan-co-id.pages.dev/api/contacts_filter_dinamis?table=nilai1&id_x=${id_x}`;
                const response = await fetch(API_URL);

                if (!response.ok) {
                    throw new Error(`HTTP error! Status: ${response.status}`);
                }

                // Mengurai respons utama sebagai JSON
                const responseData = await response.json();

                // Pastikan responsData memiliki properti 'data' dan properti itu adalah objek
                if (responseData && typeof responseData.data === 'object') {
                    // Ambil objek yang berisi data yang Anda inginkan
                    const contactData = responseData.data;

                    // Sekarang, ambil nilai dari properti-properti objek tersebut
                    const x_02 = contactData.x_02;
                    const x_05 = contactData.x_05;
                    const x_06 = contactData.x_06;
                    const x_10 = contactData.x_10;

                    // =================================================================
                    // DATA MINAT DAN KEKUATAN/KELEMAHAN
                    // =================================================================
                   
                    // =================================================================
                    // LOGIKA UNTUK MEMPROSES DATA
                    // =================================================================

                    const parts_x10 = x_10.split('|').map(part => part.trim().split(';'));
                    let hasil10 = parts_x10;
                    let result = parts_x10;

                    const parts_x02 = x_02.split('|').map(part => part.trim().split(';'));
                    const nama = parts_x02;

                    const x6_parts = x_06.split('|');
                    const soal_epps = x6_parts[0].split(';');

                    const usia = parseFloat(nama[0][4]) || 0;

                    // --- Skoring RMIB ---
                    const result_rmib = x6_parts.slice(2, 10).join(';');
                    const soal_rmib = result_rmib.split(';');

                    const p = (index) => parseInt(soal_rmib[index - 1].trim()) || 0;

                    const out = p(1) + p(24) + p(35) + p(46) + p(57) + p(68) + p(79) + p(90);
                    const mech = p(2) + p(13) + p(36) + p(47) + p(58) + p(69) + p(80) + p(91);
                    const comp = p(3) + p(14) + p(25) + p(48) + p(59) + p(70) + p(81) + p(92);
                    const acie = p(4) + p(15) + p(26) + p(37) + p(60) + p(71) + p(82) + p(93);
                    const pers = p(5) + p(16) + p(27) + p(38) + p(49) + p(72) + p(83) + p(94);
                    const aesth = p(6) + p(17) + p(28) + p(39) + p(50) + p(61) + p(84) + p(95);
                    const lite = p(7) + p(18) + p(29) + p(40) + p(51) + p(62) + p(73) + p(96);
                    const mus = p(8) + p(19) + p(30) + p(41) + p(52) + p(63) + p(74) + p(85);
                    const sos_wer = p(9) + p(20) + p(31) + p(42) + p(53) + p(64) + p(75) + p(86);
                    const cler = p(10) + p(21) + p(32) + p(43) + p(54) + p(65) + p(76) + p(87);
                    const prac = p(11) + p(22) + p(33) + p(44) + p(55) + p(66) + p(77) + p(88);
                    const med = p(12) + p(23) + p(34) + p(45) + p(56) + p(67) + p(78) + p(89);

                    let totals_rmib = {
                        "OUT": out, "MECH": mech, "COMP": comp, "ACIE": acie, "PERS": pers,
                        "AESTH": aesth, "LITE": lite, "MUS": mus, "SOS. WERV": sos_wer,
                        "CLER": cler, "PRAC": prac, "MED": med
                    };

                    // --- Fungsi Helper ---
                    function getScore(value, criteria) {
                        for (const limit in criteria) {
                            if (value <= parseInt(limit)) {
                                return criteria[limit];
                            }
                        }
                        return Object.values(criteria).pop();
                    }

                    // --- Kriteria Skoring ---
                    const iqCriteria = { 60: 1, 69: 2, 79: 3, 89: 4, 99: 5, 109: 6, 119: 7, 129: 8, 139: 9, [Number.MAX_SAFE_INTEGER]: 10 };
                    const cfitCriteria = { 2: 1, 3: 2, 4: 3, 5: 4, 7: 5, 8: 6, 9: 7, 10: 8, 11: 9, 13: 10 };
                    const tkd3Criteria = { 12: 1, 16: 2, 20: 3, 23: 4, 27: 5, 31: 6, 35: 7, 38: 8, 40: 9, [Number.MAX_SAFE_INTEGER]: 10 };
                    const tkd6Criteria = { 2: 1, 5: 2, 9: 3, 12: 4, 16: 5, 19: 6, 23: 7, 26: 8, 30: 9, [Number.MAX_SAFE_INTEGER]: 10 };
                    const achCriteria = { 2: 1, 4: 2, 6: 3, 8: 4, 10: 5, 12: 6, 14: 7, 16: 8, 18: 9, [Number.MAX_SAFE_INTEGER]: 10 };

                    // --- Skoring CFIT ---
                    const nilai_x05 = x_05.split('|');
                    const CFIT1 = parseInt(nilai_x05[0].trim()) || 0;
                    const CFIT2 = parseInt(nilai_x05[1].trim()) || 0;
                    const CFIT3 = parseInt(nilai_x05[2].trim()) || 0;
                    const CFIT4 = parseInt(nilai_x05[3].trim()) || 0;
                    const skorTotal_cfit = CFIT1 + CFIT2 + CFIT3 + CFIT4;

                    function getIQ_cfit(skorTotal, usia) {
                        const iqTable = {
                            49: [183, 183, 183, 183, 183], 48: [183, 183, 183, 179, 179], 47: [183, 183, 179, 176, 176], 46: [183, 179, 176, 173, 173], 45: [179, 176, 173, 169, 169], 44: [176, 173, 169, 167, 167], 43: [175, 171, 168, 165, 165], 42: [171, 168, 165, 161, 161], 41: [167, 163, 160, 157, 157], 40: [165, 161, 159, 155, 155], 39: [161, 159, 155, 152, 152], 38: [159, 155, 152, 149, 149], 37: [155, 152, 149, 145, 145], 36: [152, 149, 145, 142, 142], 35: [150, 147, 144, 140, 140], 34: [147, 144, 140, 137, 137], 33: [142, 139, 136, 133, 133], 32: [140, 137, 134, 131, 131], 31: [137, 134, 131, 128, 128], 30: [134, 131, 128, 126, 124], 29: [131, 128, 124, 123, 121], 28: [129, 126, 123, 121, 119], 27: [126, 123, 119, 117, 116], 26: [123, 119, 116, 114, 113], 25: [119, 116, 113, 111, 109], 24: [116, 113, 109, 108, 106], 23: [113, 109, 106, 104, 103], 22: [109, 106, 103, 101, 100], 21: [106, 103, 100, 98, 96], 20: [104, 101, 98, 96, 94], 19: [101, 98, 94, 93, 91], 18: [98, 94, 91, 89, 88], 17: [94, 91, 88, 86, 85], 16: [91, 88, 85, 83, 81], 15: [88, 85, 81, 80, 78], 14: [85, 81, 78, 76, 75], 13: [81, 78, 75, 73, 72], 12: [80, 76, 73, 72, 70], 11: [76, 73, 70, 68, 67], 10: [73, 70, 67, 65, 63], 9: [70, 67, 63, 62, 60], 8: [67, 63, 60, 58, 57], 7: [63, 60, 57, 56, 55], 6: [60, 57, 55, 53, 52], 5: [57, 55, 53, 51, 48], 4: [55, 54, 52, 50, 47], 3: [53, 52, 48, 47, 45], 2: [52, 51, 47, 46, 43], 1: [50, 50, 46, 45, 40], 0: [48, 48, 45, 43, 38],
                        };
                        let ageIndex;
                        if (usia >= 13.0 && usia <= 13.4) ageIndex = 0;
                        else if (usia >= 13.5 && usia <= 13.11) ageIndex = 1;
                        else if (usia >= 14.0 && usia <= 14.11) ageIndex = 2;
                        else if (usia >= 15.0 && usia <= 15.11) ageIndex = 3;
                        else if (usia >= 16.0) ageIndex = 4;
                        else return "Usia tidak valid";
                        return iqTable[skorTotal] ? iqTable[skorTotal][ageIndex] : "Skor total tidak valid";
                    }

                    const iq_from_cfit = getIQ_cfit(skorTotal_cfit, usia);
                    const IQ = parseInt(hasil10[0][3]) || iq_from_cfit;
                    const tkd3 = parseInt(nilai_x05[15]) || 0;
                    const tkd6 = parseInt(nilai_x05[17]) || 0;

                    // --- Skoring EPPS ---
                    const e = (index) => soal_epps[index - 1];
                    const ach_r = [e(6), e(11), e(16), e(21), e(26), e(31), e(36), e(41), e(46), e(51), e(56), e(61), e(66), e(71)];
                    const def_r = [e(2), e(12), e(17), e(22), e(27), e(32), e(37), e(42), e(47), e(52), e(57), e(62), e(67), e(72)];
                    const ord_r = [e(3), e(8), e(18), e(23), e(28), e(33), e(38), e(43), e(48), e(53), e(58), e(63), e(68), e(73)];
                    const exh_r = [e(4), e(9), e(14), e(24), e(29), e(34), e(39), e(44), e(49), e(54), e(59), e(64), e(69), e(74)];
                    const aut_r = [e(5), e(10), e(15), e(20), e(30), e(35), e(40), e(45), e(50), e(55), e(60), e(65), e(70), e(75)];
                    const aff_r = [e(76), e(81), e(86), e(91), e(96), e(106), e(111), e(116), e(121), e(126), e(131), e(136), e(141), e(146)];
                    const int_r = [e(77), e(82), e(87), e(92), e(97), e(102), e(112), e(117), e(122), e(127), e(132), e(137), e(142), e(147)];
                    const suc_r = [e(78), e(83), e(88), e(93), e(98), e(103), e(108), e(113), e(118), e(123), e(128), e(133), e(138), e(143), e(148)];
                    const dom_r = [e(79), e(84), e(89), e(94), e(99), e(104), e(109), e(114), e(119), e(124), e(129), e(134), e(139), e(144), e(149)];
                    const aba_r = [e(80), e(85), e(90), e(95), e(100), e(105), e(110), e(115), e(120), e(125), e(130), e(135), e(140), e(145), e(150)];
                    const nur_r = [e(151), e(156), e(161), e(166), e(171), e(176), e(181), e(186), e(191), e(196), e(201), e(206), e(211), e(216)];
                    const chg_r = [e(152), e(157), e(162), e(167), e(172), e(177), e(182), e(187), e(192), e(197), e(202), e(207), e(212), e(217)];
                    const het_r = [e(153), e(158), e(163), e(168), e(173), e(178), e(183), e(188), e(193), e(198), e(203), e(208), e(213), e(218)];
                    const agg_r = [e(154), e(159), e(164), e(169), e(174), e(179), e(184), e(189), e(194), e(199), e(204), e(209), e(214), e(219)];
                    const end_r = [e(155), e(160), e(165), e(170), e(175), e(180), e(185), e(190), e(195), e(200), e(205), e(210), e(215), e(220)];

                    const sum_c_ach = ach_r.filter(v => v === 'C').length;
                    const sum_c_def = def_r.filter(v => v === 'C').length;
                    const sum_c_ord = ord_r.filter(v => v === 'C').length;
                    const sum_c_exh = exh_r.filter(v => v === 'C').length;
                    const sum_c_aut = aut_r.filter(v => v === 'C').length;
                    const sum_c_aff = aff_r.filter(v => v === 'C').length;
                    const sum_c_int = int_r.filter(v => v === 'C').length;
                    const sum_c_suc = suc_r.filter(v => v === 'C').length;
                    const sum_c_dom = dom_r.filter(v => v === 'C').length;
                    const sum_c_aba = aba_r.filter(v => v === 'C').length;
                    const sum_c_nur = nur_r.filter(v => v === 'C').length;
                    const sum_c_chg = chg_r.filter(v => v === 'C').length;
                    const sum_c_het = het_r.filter(v => v === 'C').length;
                    const sum_c_agg = agg_r.filter(v => v === 'C').length;
                    const sum_c_end = end_r.filter(v => v === 'C').length;

                    const EPPS = [
                        { "jenis": "Ach", "teks1": "Achievement", "teks2": "Kebutuhan berprestasi, berhasil dalam hal-hal yang sulit dan menantang.", "nilai": sum_c_ach },
                        { "jenis": "Def", "teks1": "Deference", "teks2": "Kebutuhan untuk mengikuti figur berwenang, orang yang lebih berpengalaman.", "nilai": sum_c_def },
                        { "jenis": "Ord", "teks1": "Order", "teks2": "Kebutuhan akan keteraturan, kerapian, kebersihan, dan perencanaan.", "nilai": sum_c_ord },
                        { "jenis": "Exh", "teks1": "Exhibition", "teks2": "Kebutuhan untuk menjadi pusat perhatian dan pembicaraan.", "nilai": sum_c_exh },
                        { "jenis": "Aut", "teks1": "Autonomy", "teks2": "Kebutuhan untuk merasa bebas dan mandiri.", "nilai": sum_c_aut },
                        { "jenis": "Aff", "teks1": "Affiliation", "teks2": "Kebutuhan untuk menjalin hubungan dan persahabatan yang erat.", "nilai": sum_c_aff },
                        { "jenis": "Int", "teks1": "Intraception", "teks2": "Kebutuhan untuk memahami diri dan orang lain.", "nilai": sum_c_int },
                        { "jenis": "Suc", "teks1": "Succorance", "teks2": "Kebutuhan untuk menerima bantuan dari orang lain.", "nilai": sum_c_suc },
                        { "jenis": "Dom", "teks1": "Dominance", "teks2": "Kebutuhan untuk memimpin dan mempengaruhi orang lain.", "nilai": sum_c_dom },
                        { "jenis": "Aba", "teks1": "Abasement", "teks2": "Kebutuhan untuk merasa bersalah, tunduk, dan menerima kritikan.", "nilai": sum_c_aba },
                        { "jenis": "Nur", "teks1": "Nurturance", "teks2": "Kebutuhan untuk membantu, merawat, dan melindungi orang lain.", "nilai": sum_c_nur },
                        { "jenis": "Chg", "teks1": "Change", "teks2": "Kebutuhan akan perubahan, hal-hal baru, dan petualangan.", "nilai": sum_c_chg },
                        { "jenis": "Het", "teks1": "Heterosexuality", "teks2": "Kebutuhan untuk menjalin hubungan dengan lawan jenis.", "nilai": sum_c_het },
                        { "jenis": "Agg", "teks1": "Aggression", "teks2": "Kebutuhan untuk menyerang, menyalahkan, dan melukai orang lain.", "nilai": sum_c_agg },
                        { "jenis": "End", "teks1": "Endurance", "teks2": "Kebutuhan untuk gigih, menyelesaikan tugas hingga tuntas.", "nilai": sum_c_end }
                    ];

                    const consistencyScore = parseInt(x6_parts[1]) || 0;
                    const isConsistent = consistencyScore >= 10;
                    const nilai_x05_copy = nilai_x05.slice();
                    nilai_x05_copy.splice(15, 1);
                    nilai_x05_copy.splice(16, 1);
                    nilai_x05_copy.splice(0, 4);

                    const nilai_tkd = nilai_x05_copy.map(n => parseInt(n) || 0);

                    // --- Fungsi untuk Mengisi Data ke Halaman ---
                    function renderData() {
                        // Data Pribadi
                        document.getElementById('nama').textContent = nama[0][0];
                        document.getElementById('jenis_kelamin').textContent = nama[0][8];
                        document.getElementById('usia').textContent = `${usia} tahun`;
                        document.getElementById('pendidikan').textContent = `${nama[2][5]} ${nama[2][3]}`;
                        document.getElementById('posisi').textContent = nama[3][0];
                        const tgl = new Date();
                        const options = { year: 'numeric', month: 'long', day: 'numeric' };
                        document.getElementById('tanggal_pemeriksaan').textContent = tgl.toLocaleDateString('id-ID', options);
                        document.getElementById('tujuan_pemeriksaan').textContent = "Pemeriksaan Psikologis";

                        // Aspek Psikologis - Table
                        const aspekPsikologisBody = document.getElementById('aspek-psikologis-body');
                        aspekPsikologisBody.innerHTML = '';
                        const scores = [
                            { name: 'Kemampuan Umum', value: getScore(IQ, iqCriteria) },
                            { name: 'Daya Tangkap Visual', value: getScore(CFIT1, cfitCriteria) },
                            { name: 'Kemampuan Berpikir Logis', value: getScore(CFIT2, cfitCriteria) },
                            { name: 'Kemampuan Berpikir Abstrak', value: getScore(CFIT3, cfitCriteria) },
                            { name: 'Penalaran Verbal', value: getScore(tkd3, tkd3Criteria) },
                            { name: 'Penalaran Numerik', value: getScore(tkd6, tkd6Criteria) },
                            { name: 'Hasrat Berprestasi', value: getScore(EPPS[0].nilai, achCriteria) },
                            { name: 'Daya Tahan Stress', value: getScore(EPPS[14].nilai, achCriteria) },
                            { name: 'Kepercayaan Diri', value: getScore(EPPS[8].nilai, achCriteria) },
                            { name: 'Relasi Sosial', value: getScore(EPPS[5].nilai, achCriteria) },
                            { name: 'Kerjasama', value: getScore(EPPS[9].nilai, achCriteria) },
                            { name: 'Sistematika Kerja', value: getScore(EPPS[2].nilai, achCriteria) },
                            { name: 'Inisiatif', value: getScore(EPPS[4].nilai, achCriteria) },
                            { name: 'Kemandirian', value: getScore(EPPS[7].nilai, achCriteria) }
                        ];

                        scores.forEach((score, index) => {
                            const row = document.createElement('tr');
                            const keterangan = kekuatan_kelemahan[index].teks2;
                            let cells = '';

                            // Generate cells with or without checkmark
                            const scales = [
                                { min: 1, max: 4, label: 'K' },
                                { min: 5, max: 6, label: 'C' },
                                { min: 7, max: 8, label: 'B' },
                                { min: 9, max: 10, label: 'BS' }
                            ];

                            const scaleCellMapping = {
                                'K': 4,
                                'C': 2,
                                'B': 2,
                                'BS': 2
                            };

                            let checkmarkAdded = false;
                            
                            scales.forEach(scale => {
                                const isScoreInRange = score.value >= scale.min && score.value <= scale.max;
                                const cellCount = scaleCellMapping[scale.label];
                                for (let i = 0; i < cellCount; i++) {
                                    if (isScoreInRange && !checkmarkAdded) {
                                        cells += `<td class="highlight" style="text-align: center; vertical-align: middle;">&#10003;</td>`;
                                        checkmarkAdded = true;
                                    } else {
                                        cells += `<td></td>`;
                                    }
                                }
                            });
                            
                            row.innerHTML = `
                                <td>${score.name}</td>
                                <td>${keterangan}</td>
                                ${cells}
                            `;
                            aspekPsikologisBody.appendChild(row);
                        });

                        // IQ
                        document.getElementById('iq-value').textContent = IQ >= 130 ? `Superior (IQ: ${IQ})` :
                                                                       IQ >= 120 ? `Very Superior (IQ: ${IQ})` :
                                                                       IQ >= 110 ? `Superior (IQ: ${IQ})` :
                                                                       IQ >= 90 ? `Average (IQ: ${IQ})` :
                                                                       IQ >= 80 ? `Below Average (IQ: ${IQ})` :
                                                                       IQ >= 70 ? `Borderline (IQ: ${IQ})` :
                                                                       `Intellectually Disabled (IQ: ${IQ})`;

                        // Strengths, Weaknesses, Recommendations
                        const strengthsList = document.getElementById('strengths-list');
                        const weaknessesList = document.getElementById('weaknesses-list');
                        const recommendationsList = document.getElementById('recommendations-list');
                        strengthsList.innerHTML = '';
                        weaknessesList.innerHTML = '';
                        recommendationsList.innerHTML = '';

                        scores.forEach((score, index) => {
                            const strengthItem = document.createElement('li');
                            const weaknessItem = document.createElement('li');
                            const recommendationItem = document.createElement('li');

                            strengthItem.textContent = kekuatan_kelemahan[index].teks2;
                            weaknessItem.textContent = kekuatan_kelemahan[index].teks3;
                            recommendationItem.textContent = kekuatan_kelemahan[index].teks5;

                            strengthsList.appendChild(strengthItem);
                            weaknessesList.appendChild(weaknessItem);
                            recommendationsList.appendChild(recommendationItem);
                        });

                        // Arah Minat
                        const minatList = document.getElementById('minat-list');
                        minatList.innerHTML = '';
                        const sortedMinat = Object.entries(totals_rmib)
                            .sort(([, a], [, b]) => b - a)
                            .slice(0, 3)
                            .map(([key]) => minat.find(m => m.singkatan === key) || { arah_minat: key, keterangan_minat: "Tidak ada keterangan." });

                        sortedMinat.forEach(m => {
                            const minatItem = document.createElement('li');
                            minatItem.innerHTML = `<strong>${m.arah_minat}</strong> - ${m.keterangan_minat}`;
                            minatList.appendChild(minatItem);
                        });
                        
                        // Signature Date
                        const signatureDate = document.getElementById('signature-date');
                        signatureDate.textContent = `Medan, ${tgl.toLocaleDateString('id-ID', options)}`;
                    }

                    renderData();
                } else {
                    console.error('Properti data tidak ditemukan atau bukan objek.');
                }
            } catch (error) {
                console.error('Terjadi kesalahan saat mengambil data:', error);
            }
        }
        
        document.addEventListener('DOMContentLoaded', fetchAndLogData);
    
    </script>
    <script>
        // PDF download script
        window.jsPDF = window.jspdf.jsPDF;

        document.getElementById('downloadBtn').onclick = () => {
            const doc = new jsPDF('p', 'mm', 'a4');
            const pageHeight = doc.internal.pageSize.height;
            const imgWidth = doc.internal.pageSize.width;

            const noDownloadElements = document.querySelectorAll('.no-download');
            noDownloadElements.forEach(el => el.style.display = 'none');

            const processPage = (contentId, isFirstPage) => {
                return new Promise(resolve => {
                    const headerImg = new Image();
                    headerImg.crossOrigin = "anonymous";
                    headerImg.src = 'gambar/header.png';
                    headerImg.onload = () => {
                        const footerImgSrc = 'gambar/footer.png';
                        const footerImg = new Image();
                        footerImg.crossOrigin = "anonymous";
                        footerImg.src = footerImgSrc;
                        footerImg.onload = () => {
                            if (!isFirstPage) {
                                doc.addPage();
                            }
                            doc.addImage(headerImg, 'PNG', 0, 0, imgWidth, 30);
                            
                            const content = document.getElementById(contentId);
                            html2canvas(content, { scale: 2, useCORS: true }).then(canvas => {
                                const imgData = canvas.toDataURL('image/png');
                                const contentHeight = (canvas.height * imgWidth) / canvas.width;
                                doc.addImage(imgData, 'PNG', 0, 30, imgWidth, contentHeight);

                                const footerImg = new Image();
                                footerImg.crossOrigin = "anonymous";
                                footerImg.src = footerImgSrc;
                                footerImg.onload = () => {
                                    doc.addImage(footerImg, 'PNG', 0, pageHeight - 30, imgWidth, 30);
                                    resolve();
                                };
                            });
                        };
                    };
                });
            };

            processPage('downloadContent1', true)
                .then(() => processPage('downloadContent2', false))
                .then(() => {
                    doc.save('profil_pemeriksaan_psikologis.pdf');
                    noDownloadElements.forEach(el => el.style.display = '');
                });
        };
    </script>
</body>
</html>
