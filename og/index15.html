<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generator Otomatis Penyemangat Harian - Lidan Psikologi</title>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            padding: 40px;
            max-width: 1300px;
            width: 100%;
        }

        h1 {
            color: #333;
            margin-bottom: 10px;
            font-size: 28px;
        }

        .subtitle {
            color: #666;
            margin-bottom: 30px;
            font-size: 14px;
        }

        .controls {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .input-group {
            display: flex;
            flex-direction: column;
        }

        label {
            color: #555;
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 14px;
        }

        input[type="number"],
        input[type="url"],
        select,
        textarea,
        input[type="text"] {
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s;
            font-family: inherit;
        }

        input[type="number"]:focus,
        input[type="url"]:focus,
        select:focus,
        textarea:focus,
        input[type="text"]:focus {
            outline: none;
            border-color = '#667eea';
        }

        textarea {
            resize: vertical;
            min-height: 80px;
            grid-column: 1 / -1;
        }

        input[type="color"] {
            width: 60px;
            height: 40px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
        }

        input[type="range"] {
            -webkit-appearance: none;
            width: 100%;
            height: 10px;
            background: #e0e0e0;
            border-radius: 5px;
            cursor: pointer;
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            background: #667eea;
            border-radius: 50%;
            cursor: pointer;
        }


        .canvas-container {
            background: #f5f5f5;
            border-radius: 12px;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 20px;
            overflow: auto;
        }

        canvas {
            border-radius: 8px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            max-width: 100%;
            height: auto;
        }

        .button-group {
            display: flex;
            gap: 15px;
            justify-content: center;
        }

        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
        }

        button:active {
            transform: translateY(0);
        }

        .section-title {
            color: #333;
            font-size: 18px;
            font-weight: 700;
            margin: 30px 0 15px 0;
            padding-bottom: 10px;
            border-bottom: 2px solid #667eea;
            grid-column: 1 / -1;
        }

        .help-text {
            color: #888;
            font-size: 12px;
            margin-top: 4px;
        }

        @media (max-width: 768px) {
            .controls {
                grid-template-columns: 1fr;
            }
            
            .container {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>âœ¨ Generator Otomatis Penyemangat Harian - Lidan Psikologi</h1>
        <p class="subtitle">Membuat **365 gambar** pesan penyemangat otomatis dengan tanggal, dimulai 1 Januari 2026. (Menggunakan 150 pesan unik)</p>

        <div class="controls">
            <div class="section-title">ğŸ¨ Pengaturan Tampilan</div>
            
            <div class="input-group">
                <label>Ukuran Font (Pesan Utama):</label>
                <input type="number" id="fontSizeEn" value="48" min="20" max="150">
            </div>

            <div class="input-group">
                <label>Ukuran Font (Tanggal):</label>
                <input type="number" id="fontSizeId" value="28" min="15" max="100">
                <span class="help-text">Mengatur ukuran font untuk hari, tanggal, bulan, dan tahun.</span>
            </div>

            <div class="input-group">
                <label>Warna Teks:</label>
                <input type="color" id="textColor" value="#ffffff">
            </div>
            
            <div class="input-group">
                <label>Warna Shadow Teks:</label>
                <input type="color" id="shadowColor" value="#000000">
                <span class="help-text">Tambahkan shadow untuk visibilitas.</span>
            </div>

            <div class="section-title">ğŸ–¼ï¸ Pengaturan Background</div>

            <div class="input-group">
                <label>Kontras Gambar Background (0.5 - 2.0):</label>
                <input type="number" id="bgContrast" value="1.0" min="0.5" max="2.0" step="0.1">
                <span class="help-text">1.0 = normal. Mengatur tingkat kontras.</span>
            </div>
            
            <div class="input-group">
                <label>Warna Gambar Background (Hue Rotate):</label>
                <input type="range" id="bgHue" value="0" min="0" max="360" step="1">
                <span class="help-text">0 = normal. Memutar rona warna (dalam derajat).</span>
            </div>
            
            <div class="section-title">ğŸ·ï¸ Pengaturan Logo & Branding</div>
            
            <div class="input-group">
                <label>URL Logo:</label>
                <input type="url" id="logoUrl" value="https://cipta.my.id/og/gambar/logo-psikologi.png" placeholder="https://example.com/logo.png">
                <span class="help-text">Masukkan URL logo (akan muncul di kanan atas)</span>
            </div>

            <div class="input-group">
                <label>Teks Brand:</label>
                <input type="text" id="brandText" value="Lidan Psikologi" placeholder="Nama Brand">
            </div>

            <div class="input-group">
                <label>Ukuran Logo:</label>
                <input type="number" id="logoSize" value="60" min="30" max="150">
                <span class="help-text">Ukuran logo dalam piksel.</span>
            </div>
        </div>

        <div class="canvas-container">
            <canvas id="canvas" width="1200" height="630"></canvas>
        </div>

        <div class="button-group">
            <button onclick="updatePreview(0)">ğŸ”„ Update Preview (Hari ke-1)</button>
            <button onclick="downloadAllImages()">â¬‡ï¸ Generate & Download 365 Gambar ZIP</button> 
        </div>

        <p id="statusMessage" style="text-align: center; margin-top: 20px; font-weight: bold; color: #333;"></p>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const DEFAULT_WIDTH = 1200;
        const DEFAULT_HEIGHT = 630;
        
        canvas.width = DEFAULT_WIDTH;
        canvas.height = DEFAULT_HEIGHT;

        let logoImage = new Image();
        let logoLoaded = false;
        
        // --- Setup Awal Logo ---
        const logoUrlInput = document.getElementById('logoUrl');
        logoImage.crossOrigin = 'Anonymous'; 
        logoImage.src = logoUrlInput.value;
        logoImage.onload = function() {
            logoLoaded = true;
            updatePreview(0); 
        };
        logoImage.onerror = function() {
            logoLoaded = false;
            updatePreview(0);
        };
        logoUrlInput.addEventListener('change', function() {
            const url = this.value.trim();
            if (url) {
                logoLoaded = false;
                logoImage.src = url;
            } else {
                logoLoaded = false;
                updatePreview(0);
            }
        });
        // --- Akhir Setup Awal Logo ---

        /**
         * FUNGSI UNTUK MENGHASILKAN DATA 365 HARI DIMULAI 1 JANUARI 2026
         */
        function generate365DaysData() {
            // 150 Pesan Penyemangat Bertema Psikologis (Variasi Jauh Lebih Besar)
            const baseMessages = [
                "Kesehatan mental Anda adalah prioritas. Jangan ragu untuk memprioritaskan diri sendiri.",
                "Perubahan kecil yang konsisten lebih berharga daripada janji besar yang terabaikan.",
                "Anda tidak harus menjadi sempurna untuk memulai. Cukup mulai.",
                "Hari ini, izinkan diri Anda beristirahat. Produktivitas bukanlah harga diri Anda.",
                "Jangan terlalu keras pada diri sendiri atas hal-hal yang tidak bisa Anda kendalikan.",
                "Kesempurnaan adalah ilusi yang merampas kedamaian Anda. Lepaskan tuntutan itu.",
                "Berlatihlah bersyukur hari ini. Itu adalah magnet untuk lebih banyak kebahagiaan.",
                "Terkadang, langkah mundur adalah ancang-ancang untuk lompatan yang lebih jauh.",
                "Rasa cemas adalah sinyal, bukan takdir. Dengarkan, lalu biarkan ia berlalu.",
                "Batasan yang jelas adalah bentuk perlindungan diri. Berani berkata 'tidak'.",
                "Anda memiliki kekuatan untuk memilih reaksi Anda, bukan apa yang terjadi pada Anda.",
                "Penyembuhan bukanlah garis lurus; ada hari baik dan hari sulit. Itu wajar.",
                "Perbandingan adalah pencuri kegembiraan. Fokus pada jalur Anda sendiri.",
                "Kasih sayang pada diri sendiri adalah dasar dari kasih sayang untuk orang lain.",
                "Apa yang Anda rasakan adalah valid. Beri nama emosi Anda tanpa menghakiminya.",
                "Rasa sakit hari ini akan menjadi kekuatan Anda esok hari.",
                "Jangan biarkan masa lalu menyandera potensi masa depan Anda.",
                "Beranilah menjadi diri Anda yang otentik. Itu adalah kekuatan super Anda.",
                "Mencari bantuan adalah tanda kekuatan, bukan kelemahan.",
                "Ingat, pertumbuhan tidak selalu terlihat. Akar Anda sedang menguat.",
                "Beri diri Anda izin untuk merasa sedih, kecewa, atau lelah.",
                "Ketika Anda merasa kewalahan, kembali ke napas Anda. Itu adalah jangkar Anda.",
                "Masa depan Anda diciptakan oleh apa yang Anda lakukan hari ini, bukan besok.",
                "Kebahagiaan sejati terletak pada penerimaan, bukan penolakan.",
                "Kecilkan volume kritik internal Anda. Ganti dengan suara yang mendukung.",
                "Terkadang, hal paling berani yang bisa Anda lakukan adalah beristirahat.",
                "Anda lebih kuat daripada perjuangan yang Anda hadapi.",
                "Berhenti menunda-nunda hidup Anda. Mulailah hidup di saat ini.",
                "Kerentanan adalah pintu masuk menuju koneksi yang lebih dalam.",
                "Jangan biarkan bayangan keraguan menyelimuti cahaya potensi Anda.",
                "Pahami bahwa Anda telah bertahan dari semua hari terburuk Anda sejauh ini.",
                "Jadilah pendengar yang baik untuk diri Anda sendiri. Apa yang Anda butuhkan saat ini?",
                "Jangan menunggu motivasi. Disiplinlah yang akan membawa Anda ke sana.",
                "Hargai prosesnya. Bukan hanya hasil akhir yang penting, tapi siapa Anda saat mencapainya.",
                "Anda adalah kisah yang sedang ditulis. Pastikan bab ini adalah tentang ketahanan.",
                "Keluar dari pikiran Anda dan masuklah ke dalam hidup Anda.",
                "Terapkan pemikiran 'cukup baik' hari ini. Bebaskan diri dari beban sempurna.",
                "Kualitas hidup Anda tergantung pada kualitas pikiran Anda. Pilih yang positif.",
                "Jangan biarkan kesibukan menjadi penghalang untuk keintiman dengan diri sendiri.",
                "Cinta diri bukan egois. Itu adalah penting.",
                "Kesalahan adalah bukti bahwa Anda telah mencoba. Rayakan keberanian Anda.",
                "Hari ini, biarkan diri Anda melakukan hal-hal dengan santai.",
                "Ketahanan dibangun dari kepingan-kepingan bangkit dari kesulitan.",
                "Anda adalah satu-satunya orang yang bertanggung jawab atas energi yang Anda bawa ke ruangan.",
                "Jangan biarkan kritik orang lain mendefinisikan realitas Anda.",
                "Pertumbuhan sejati terjadi di luar zona nyaman Anda. Ambil risiko kecil hari ini.",
                "Jaga ruang mental Anda seperti Anda menjaga rumah fisik Anda. Bersihkan kekacauan.",
                "Kepercayaan diri bukan 'mereka akan menyukai saya', tetapi 'saya akan baik-baik saja jika mereka tidak menyukai saya'.",
                "Hari ini adalah kanvas kosong. Lukis dengan warna yang Anda pilih.",
                "Anda adalah master dari takdir Anda. Ambil kemudi.",
                "Kesabaran adalah bentuk penerimaan yang paling sulit. Berlatihlah.",
                "Jangan lari dari rasa takut Anda, tetapi ajaklah ia berjalan bersama Anda.",
                "Hidup adalah serangkaian 'sekarang'. Nikmati yang ini.",
                "Kekuatan untuk mengubah hidup Anda ada di tangan Anda.",
                "Apa yang tidak terucapkan seringkali yang paling penting. Mulailah percakapan yang jujur.",
                "Ketika menghadapi tantangan, tanyakan: Pelajaran apa yang bisa saya ambil?",
                "Anda layak mendapatkan semua yang terbaik dalam hidup, termasuk kedamaian.",
                "Kebisingan di luar tidak sepenting kedamaian di dalam.",
                "Rayakan kemenangan kecil. Itu adalah bahan bakar untuk perjalanan panjang.",
                "Jangan ukur kemajuan Anda dengan meteran orang lain.",
                "Emosi adalah tamu. Sambut mereka, dengarkan, dan biarkan mereka pergi.",
                "Terlalu banyak berpikir adalah cara halus untuk menyabotase diri sendiri.",
                "Berhentilah membandingkan diri Anda saat ini dengan diri Anda yang 'seharusnya'.",
                "Jangan biarkan mimpi Anda hanya menjadi proyeksi, jadikan itu tindakan nyata.",
                "Setiap 'tidak' yang Anda katakan pada hal yang salah adalah 'ya' pada hal yang benar.",
                "Keajaiban terjadi di luar rencana Anda. Fleksibel adalah kuncinya.",
                "Ingat, Anda adalah orang dewasa yang mampu mengatasi masalah.",
                "Hentikan siklus *overthinking* dengan mengambil langkah kecil.",
                "Anda tidak perlu membenarkan kebahagiaan Anda kepada siapa pun.",
                "Jika Anda lelah, belajarlah untuk beristirahat, bukan menyerah.",
                "Rasa takut adalah navigasi. Itu menunjukkan di mana Anda perlu tumbuh.",
                "Hidup yang baik adalah yang diinspirasi oleh cinta dan dipandu oleh ilmu.",
                "Cari kejelasan, bukan hanya kepastian.",
                "Jangan terlalu sibuk mencari kebahagiaan sehingga Anda lupa menikmatinya.",
                "Saat ragu, tanyakan pada diri Anda: Apa yang akan dilakukan oleh versi diri saya yang paling berani?",
                "Berinvestasi dalam diri sendiri adalah investasi terbaik yang pernah ada.",
                "Setiap hari, berikan yang terbaik dari diri Anda, bukan yang tersisa.",
                "Terimalah ketidaksempurnaan. Mereka adalah bumbu unik kehidupan Anda.",
                "Berhenti mencari persetujuan dari luar. Validasi diri Anda sendiri.",
                "Jalan menuju pemulihan dimulai dengan satu langkah kecil.",
                "Kegagalan hanyalah data. Pelajari, adaptasi, dan lanjutkan.",
                "Anda tidak harus menanggung semua beban sendirian. Berbagi itu kekuatan.",
                "Ucapkan terima kasih pada diri Anda atas semua yang telah Anda lalui.",
                "Tujuan Anda tidak harus besar; cukup membuat Anda bangun dengan antusias.",
                "Hari ini, lepaskan dendam. Itu adalah racun yang hanya melukai Anda.",
                "Jangan biarkan kesibukan menjadi alasan untuk tidak hidup sepenuhnya.",
                "Rasa ingin tahu adalah guru terbaik. Selalu bertanya 'mengapa?'.",
                "Pilihlah respons yang tenang daripada reaksi yang emosional.",
                "Masa lalu tidak sama dengan masa depan. Anda bebas menulis ulang.",
                "Jadilah lembut pada diri sendiri saat Anda membutuhkannya.",
                "Kekuatan Anda diukur dari seberapa baik Anda pulih dari badai.",
                "Biarkan tindakan Anda berbicara lebih keras daripada kata-kata Anda.",
                "Kebahagiaan adalah keputusan, bukan hasil. Putuskan untuk bahagia hari ini.",
                "Anda memiliki lebih banyak kendali daripada yang dipikirkan oleh pikiran cemas Anda.",
                "Setiap pagi adalah kesempatan untuk mereset diri. Gunakan itu.",
                "Jangan menunggu 'saat yang tepat'. Saat yang tepat adalah sekarang.",
                "Berhenti menunggu untuk diizinkan. Beri izin pada diri Anda sendiri.",
                "Fokus pada lingkaran pengaruh Anda, bukan lingkaran kekhawatiran Anda.",
                "Kedamaian dimulai dengan senyum dari dalam.",
                "Pahami batas-batas Anda dan hormati itu. Istirahat adalah bagian dari proses.",
                "Anda tidak harus menyelesaikan semua hal sekaligus. Ambil satu per satu.",
                "Rasa terima kasih mengubah apa yang kita miliki menjadi cukup.",
                "Jangan biarkan rasa bersalah atas masa lalu menghalangi kegembiraan masa kini.",
                "Keberhasilan adalah hasil dari serangkaian kegagalan kecil yang diatasi.",
                "Biarkan cahaya di dalam diri Anda menjadi pemandu Anda.",
                "Jadilah pembuat keajaiban Anda sendiri.",
                "Jangan takut pada kesendirian; di sana Anda menemukan kekuatan sejati.",
                "Ambil waktu sejenak untuk mengapresiasi keindahan di sekitar Anda.",
                "Kesadaran adalah langkah pertama menuju perubahan positif.",
                "Anda sedang berproses. Itu lebih dari cukup.",
                "Bersabarlah dengan diri Anda sendiri, seperti Anda sabar pada orang yang Anda cintai.",
                "Kebijaksanaan adalah tahu kapan harus berhenti berusaha dan mulai menerima.",
                "Jaga energi Anda. Jauhi hal-hal yang menguras semangat.",
                "Anda berhak merasa bangga atas pencapaian sekecil apa pun.",
                "Kehidupan adalah gema. Apa yang Anda kirimkan, akan kembali pada Anda.",
                "Pilihlah untuk melihat kemungkinan, bukan hambatan.",
                "Jangan biarkan kemarin mendikte hari ini.",
                "Saat Anda merasa terjebak, ubah rutinitas Anda sedikit.",
                "Komunikasi yang efektif adalah mendengarkan dengan niat untuk memahami.",
                "Hiduplah sedemikian rupa sehingga Anda akan bangga mengingat hari ini.",
                "Kekuatan psikologis terletak pada kemampuan untuk beradaptasi.",
                "Jangan takut untuk meninggalkan apa yang tidak lagi melayani Anda.",
                "Tentukan hari ini sebagai hari untuk memaafkan, terutama diri sendiri.",
                "Kehadiran Anda adalah hadiah. Berikan diri Anda sepenuhnya di sini dan sekarang.",
                "Tidak apa-apa untuk tidak apa-apa.",
                "Berhentilah mencari validasi eksternal. Semua yang Anda butuhkan ada di dalam.",
                "Fokus pada pernapasan Anda. Setiap napas adalah awal yang baru.",
                "Anda tidak bisa mengontrol segalanya. Lepaskan keinginan untuk itu.",
                "Keindahan hidup terletak pada ketidakpastiannya.",
                "Jadikan diri Anda prioritas hari ini.",
                "Hidup adalah tentang menemukan diri Anda, bukan tentang menciptakan diri Anda.",
                "Jangan biarkan standar orang lain menjadi ukuran kebahagiaan Anda.",
                "Ketahui nilai Anda. Jangan pernah kompromi untuk mendapatkan penerimaan.",
                "Jika Anda lelah, istirahatlah. Jika Anda tidak yakin, tanyakan.",
                "Setiap pengalaman, baik atau buruk, adalah guru Anda.",
                "Otak Anda adalah organ yang luar biasa. Beri ia makanan yang baik.",
                "Ingat: Anda adalah penulis cerita hidup Anda.",
                "Rasa syukur hari ini adalah fondasi untuk hari esok yang lebih baik.",
                "Jangan biarkan 'seharusnya' merampas kebahagiaan 'saat ini'.",
                "Terus maju, bahkan jika Anda hanya bergerak satu inci.",
                "Kecilkan suara yang meragukan Anda. Dengarkan suara batin Anda.",
                "Berani untuk bahagia, terlepas dari keadaan luar.",
                "Fokuslah pada apa yang Anda miliki, bukan pada apa yang hilang.",
                "Kasih sayang adalah jembatan yang menghubungkan hati manusia.",
                "Jadilah agen perubahan untuk diri Anda sendiri.",
                "Jangan biarkan rasa takut kehilangan menghentikan Anda dari mencoba.",
                "Keheningan adalah tempat di mana kebijaksanaan lahir. Carilah itu.",
                "Perjuangan Anda tidak mendefinisikan Anda, tetapi cara Anda menghadapinya yang mendefinisikan.",
                "Hargai keunikan Anda. Tidak ada orang lain yang seperti Anda.",
                "Setiap hari adalah kesempatan kedua untuk melakukan yang benar.",
                "Jadikan diri Anda alasan untuk tersenyum hari ini.",
                "Rangkul ketidaksempurnaan Anda. Mereka adalah bagian dari pertumbuhan.",
                "Kekuatan emosional adalah mengetahui kapan harus menahan dan kapan harus melepaskan.",
                "Biarkan diri Anda dimaafkan, oleh diri sendiri dan orang lain.",
                "Jangan biarkan rasa bersalah yang tidak perlu membebani hari Anda.",
                "Bicara lembut pada diri sendiri, terutama saat Anda menghadapi kesulitan.",
                "Anda tidak harus menyelesaikan hari ini dengan sempurna, cukup selesaikan dengan baik.",
                "Setiap kesulitan membawa benih manfaat yang setara atau lebih besar. Temukan itu.",
                "Hidup Anda membaik hanya ketika Anda mengambil risiko. Risiko pertama adalah jujur.",
                "Jadikan perhatian penuh (mindfulness) sebagai sahabat harian Anda."
            ];

            const messages = [];
            // Mulai dari 1 Januari 2026 (YYYY-MM-DD)
            const startDate = new Date('2026-01-01T12:00:00Z'); 
            
            // Opsi format tanggal Indonesia
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };

            // 365 hari untuk tahun 2026 (tahun non-kabisat)
            for (let i = 0; i < 365; i++) {
                const currentDate = new Date(startDate);
                currentDate.setDate(startDate.getDate() + i);

                // Format tanggal Indonesia
                const formatter = new Intl.DateTimeFormat('id-ID', options);
                const dateString = formatter.format(currentDate);

                messages.push({
                    // Gunakan modulus untuk mengulang pesan jika 365 hari > jumlah pesan (150)
                    message: baseMessages[i % baseMessages.length], 
                    date: dateString 
                });
            }
            
            return messages;
        }

        const quotesData = generate365DaysData();
        const totalImages = quotesData.length;
        
        // URL Picsum harus unik untuk 365 gambar. Kita gunakan ID 100 sampai 464.
        const imageUrls = Array.from({length: totalImages}, (_, i) => 
            `https://picsum.photos/id/${100 + i}/${DEFAULT_WIDTH}/${DEFAULT_HEIGHT}`
        );

        // --- Event listeners untuk kontrol ---
        document.getElementById('fontSizeEn').addEventListener('input', () => updatePreview(0));
        document.getElementById('fontSizeId').addEventListener('input', () => updatePreview(0));
        document.getElementById('textColor').addEventListener('input', () => updatePreview(0));
        document.getElementById('shadowColor').addEventListener('input', () => updatePreview(0));
        document.getElementById('bgContrast').addEventListener('input', () => updatePreview(0));
        document.getElementById('bgHue').addEventListener('input', () => updatePreview(0));
        document.getElementById('brandText').addEventListener('input', () => updatePreview(0));
        document.getElementById('logoSize').addEventListener('input', () => updatePreview(0));


        /**
         * Memecah teks menjadi baris
         */
        function wrapText(context, text, maxWidth) {
            const words = text.split(' ');
            let lines = [];
            let currentLine = words[0] || '';

            for (let i = 1; i < words.length; i++) {
                const word = words[i];
                const width = context.measureText(currentLine + " " + word).width;
                if (width < maxWidth) {
                    currentLine += " " + word;
                } else {
                    lines.push(currentLine);
                    currentLine = word;
                }
            }
            lines.push(currentLine);
            return lines;
        }

        /**
         * Menggambar overlay teks (termasuk logo, pesan, dan tanggal)
         */
        function drawTextOverlay(context, bgImg, data) {
            const bgW = DEFAULT_WIDTH;
            const bgH = DEFAULT_HEIGHT;
            
            const mainFontSize = parseInt(document.getElementById('fontSizeEn').value) || 48;
            const dateFontSize = parseInt(document.getElementById('fontSizeId').value) || 28;
            const textColor = document.getElementById('textColor').value;
            const shadowColor = document.getElementById('shadowColor').value;
            const brandText = document.getElementById('brandText').value; 
            const logoSize = parseInt(document.getElementById('logoSize').value) || 60; 
            
            const contrastValue = parseFloat(document.getElementById('bgContrast').value) || 1.0;
            const hueValue = parseInt(document.getElementById('bgHue').value) || 0;
            
            const padding = 60; 
            const maxWidth = bgW - (padding * 2);
            
            context.clearRect(0, 0, bgW, bgH);

            // Draw background
            const isBgLoaded = bgImg && bgImg.complete && bgImg.naturalWidth !== 0;

            if (isBgLoaded) {
                context.filter = `contrast(${contrastValue}) hue-rotate(${hueValue}deg)`;
                context.drawImage(bgImg, 0, 0, bgW, bgH);
                context.fillStyle = 'rgba(0, 0, 0, 0.5)'; // Overlay gelap
                context.fillRect(0, 0, bgW, bgH);
                context.filter = 'none'; // Hapus filter
            } else {
                // Fallback to gradient
                const gradient = context.createLinearGradient(0, 0, bgW, bgH);
                gradient.addColorStop(0, '#667eea');
                gradient.addColorStop(1, '#764ba2');
                context.fillStyle = gradient;
                context.fillRect(0, 0, bgW, bgH);
            }
            
            // --- Draw Logo and Brand Text in Top Right ---
            const brandPadding = 40; 
            const logoY = brandPadding;

            context.fillStyle = '#ffffff';
            const brandFontSize = 28;
            context.font = `bold ${brandFontSize}px Segoe UI, sans-serif`;
            const textWidth = context.measureText(brandText).width;
            
            const currentLogoSize = logoSize;

            const totalWidth = logoLoaded ? (currentLogoSize + 15 + textWidth) : textWidth;
            const logoX = bgW - brandPadding - totalWidth;
            
            // Draw logo if loaded 
            if (logoLoaded) {
                context.shadowColor = shadowColor;
                context.shadowBlur = 5;
                context.shadowOffsetX = 2;
                context.shadowOffsetY = 2;
                context.drawImage(logoImage, logoX, logoY, currentLogoSize, currentLogoSize);
                context.shadowColor = 'transparent'; 
                context.shadowBlur = 0;
                context.shadowOffsetX = 0;
                context.shadowOffsetY = 0;
            }

            // Draw brand text (to the right of logo)
            context.shadowColor = shadowColor;
            context.shadowBlur = 5;
            context.shadowOffsetX = 2;
            context.shadowOffsetY = 2;

            context.textAlign = 'left';
            context.textBaseline = 'middle';
            const brandTextY = logoY + currentLogoSize / 2;
            const brandTextX = logoLoaded ? (logoX + currentLogoSize + 15) : logoX;
            context.fillText(brandText, brandTextX, brandTextY);
            
            context.shadowColor = 'transparent';
            context.shadowBlur = 0;
            context.shadowOffsetX = 0;
            context.shadowOffsetY = 0;
            // --- Akhir Draw Logo and Brand Text ---


            // --- Draw Main Message and Date Text in Center ---
            context.textAlign = 'center';
            context.textBaseline = 'middle';
            
            // 1. Calculate space for Message
            context.font = `bold ${mainFontSize}px 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif`;
            const linesMessage = wrapText(context, data.message, maxWidth);
            const lineHeightMessage = mainFontSize * 1.4;
            const totalTextHeightMessage = linesMessage.length * lineHeightMessage;

            // 2. Calculate space for Date (Tanggal)
            context.font = `${dateFontSize}px 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif`; 
            const linesDate = wrapText(context, data.date, maxWidth); 
            const lineHeightDate = dateFontSize * 1.4;
            const totalTextHeightDate = linesDate.length * lineHeightDate;

            const spacing = 40; 
            const totalTextHeight = totalTextHeightMessage + spacing + totalTextHeightDate;

            let startY = (bgH - totalTextHeight) / 2;
            
            context.shadowColor = shadowColor;
            context.shadowBlur = 10;
            context.shadowOffsetX = 3;
            context.shadowOffsetY = 3;
            
            // 3. Draw Message Text
            context.fillStyle = textColor;
            context.font = `bold ${mainFontSize}px 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif`;
            linesMessage.forEach((line, index) => {
                const yPos = startY + (index * lineHeightMessage) + (lineHeightMessage / 2);
                context.fillText(line, bgW / 2, yPos);
            });
            
            // 4. Update startY for Date Text
            startY += totalTextHeightMessage + spacing;

            // 5. Draw Date Text
            context.font = `${dateFontSize}px 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif`;
            linesDate.forEach((line, index) => {
                const yPos = startY + (index * lineHeightDate) + (lineHeightDate / 2);
                context.fillText(line, bgW / 2, yPos);
            });
            
            context.shadowColor = 'transparent';
            context.shadowBlur = 0;
            context.shadowOffsetX = 0;
            context.shadowOffsetY = 0;
        }


        function updatePreview(index) {
            const imageUrl = imageUrls[index];
            const data = quotesData[index];
            const image = new Image();
            
            document.getElementById('statusMessage').innerText = `Loading Preview Hari ke-${index + 1}/${totalImages}...`;

            image.crossOrigin = 'Anonymous'; 
            image.src = imageUrl;

            image.onload = function() {
                drawTextOverlay(ctx, image, data);
                document.getElementById('statusMessage').innerText = `Preview Hari ke-${index + 1}/${totalImages} ditampilkan. (Tanggal: ${data.date})`;
            };

            image.onerror = function() {
                document.getElementById('statusMessage').innerText = `Gagal memuat gambar ${index + 1}. Menampilkan background fallback.`;
                drawTextOverlay(ctx, null, data); 
            };
        }

        /**
         * FUNGSI MULTI-DOWNLOAD DENGAN JSZip MENGGUNAKAN WORKER POOL CONTINUOUS
         */
        async function downloadAllImages() {
            const zip = new JSZip();
            let filesProcessed = 0;
            let fallbacksUsed = 0;
            const totalFiles = imageUrls.length;
            const KUALITAS_KOMPRESI = 0.8; 
            const MAX_CONCURRENT = 10; // Batas koneksi serentak 

            if (totalFiles === 0) {
                 alert("Tidak ada data kutipan untuk diproses.");
                 return;
            }

            document.getElementById('statusMessage').innerText = `Mulai memproses ${totalFiles} gambar... Harap tunggu. Proses akan berjalan mulus.`;

            // Array semua indeks yang perlu diproses (digunakan sebagai queue)
            const allIndices = Array.from({length: totalFiles}, (_, i) => i).reverse();

            /**
             * Fungsi pembantu untuk memuat, memproses, dan menambahkan satu file ke ZIP (mengembalikan Promise)
             */
            const processFile = (index) => {
                return new Promise((resolve) => {
                    const imageUrl = imageUrls[index];
                    const data = quotesData[index];

                    const image = new Image();
                    image.crossOrigin = 'Anonymous';
                    
                    const handleImageProcessing = (img, isFallback) => {
                        // 1. Buat kanvas baru di memori
                        const tempCanvas = document.createElement('canvas');
                        tempCanvas.width = DEFAULT_WIDTH;
                        tempCanvas.height = DEFAULT_HEIGHT;
                        const tempCtx = tempCanvas.getContext('2d');

                        // 2. Gambar overlay teks
                        drawTextOverlay(tempCtx, img, data);
                        
                        // 3. Tentukan nama file
                        // Ambil 30 karakter pertama dari pesan utama untuk nama file
                        const messageText = data.message.substring(0, 30).replace(/[^a-zA-Z0-9]/g, '_').trim(); 
                        const fallbackSuffix = isFallback ? '_FALLBACK' : '';
                        const fileName = `Hari_${index + 1}_${messageText}${fallbackSuffix}.jpeg`; 

                        // 4. Konversi ke Data URL JPEG dan ambil Base64
                        const dataUrl = tempCanvas.toDataURL('image/jpeg', KUALITAS_KOMPRESI);
                        const base64Data = dataUrl.split(',')[1];
                        zip.file(fileName, base64Data, {base64: true});

                        filesProcessed++;
                        if (isFallback) fallbacksUsed++;
                        
                        // PENTING: Update status secara kontinyu
                        document.getElementById('statusMessage').innerText = `Memproses... ${filesProcessed}/${totalFiles} selesai (Sukses: ${filesProcessed - fallbacksUsed}, Fallback: ${fallbacksUsed}).`;

                        resolve(); 
                    };

                    image.onload = () => handleImageProcessing(image, false);
                    image.onerror = () => handleImageProcessing(null, true); 
                    
                    image.src = imageUrl;
                });
            };
            
            // --- LOGIKA WORKER POOL CONTINUOUS ---

            // Fungsi Worker: Mengambil tugas (indeks) dari queue hingga queue kosong
            const worker = async () => {
                let index;
                // Selama masih ada indeks di array, ambil dan proses
                while ((index = allIndices.pop()) !== undefined) {
                    await processFile(index);
                }
            };
            
            // Jalankan sejumlah worker (10) serentak
            const workers = Array(MAX_CONCURRENT).fill(null).map(() => worker());

            // Tunggu hingga semua pekerja menyelesaikan semua tugas
            await Promise.all(workers);
            
            // --- AKHIR LOGIKA WORKER POOL ---

            // 6. Generate dan Download ZIP setelah semua file diproses
            zip.generateAsync({type:"blob"})
            .then(function(content) {
                saveAs(content, "365_Penyemangat_Lidan_Psikologi_2026.zip");
                document.getElementById('statusMessage').innerText = `âœ… Selesai! File ZIP berisi ${totalFiles} gambar berhasil diunduh.`;
            });
        }

        // Initial render (Hari ke-1)
        updatePreview(0);
    </script>
</body>
</html>